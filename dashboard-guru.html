<!DOCTYPE html>
<html lang="id">
	<head>
		<meta charset="utf-8" />
		<meta name="viewport" content="width=device-width,initial-scale=1" />
		<title>Dashboard - SATRIA SMAGER</title>

        <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
		<link
			href="https://fonts.googleapis.com/css?family=Source+Sans+Pro:200,300,400,600,700&display=swap"
			rel="stylesheet" />
        <link rel="stylesheet" href="styles/dashboard/manajemen.css">
        <link rel="stylesheet" href="styles/dashboard/daftar-card.css">
        <link rel="stylesheet" href="styles/dashboard/statis-card.css">
        <link rel="stylesheet" href="styles/dashboard/global.css">
	</head>
	<body>
        
		<!-- background squares -->
		<ul class="bg-squares" aria-hidden="true">
			<li></li>
			<li></li>
			<li></li>
			<li></li>
			<li></li>
			<li></li>
			<li></li>
			<li></li>
			<li></li>
			<li></li>
		</ul>
        

        <div class="dashboard">
            <!-- Sidebar (left) -->
            <aside
                class="sidebar"
                role="navigation"
                aria-label="Navigation Sidebar">
                <br>
                <br>
                <div class="always-show-nav">
                    <button class="nav-btn active" id="go-lap">Laporkan</button>
                    <button class="nav-btn" id="go-stat">Statistik</button>
                    <button class="nav-btn" id="go-daf">Daftar Pelanggaran</button>
                    <button class="nav-btn" id="go-mngn">Manajemen Sistem</button>
                    <div class="spacer"></div>
                    <div class="always-show-nav-bttom">
                        <div style="display: flex; gap: 12px; align-items: center">
                            <img
                                src="./avatar.png"
                                alt="avatar"
                                style="
                                    width: 48px;
                                    height: 48px;
                                    border-radius: 10px;
                                    object-fit: cover;
                                    border: 2px solid rgba(255, 255, 255, 0.06);
                                " />
                            <div style="font-weight: 700"><span class="username-display"></span></div>
                        </div>
                        
                        <button class="nav-btn logout" style="margin-top: 12px">
                            LOG OUT
                        </button>
                    </div>
                </div>
            </aside>

            <main class="main" role="main">
                <div class="right_menu">
                    <div class="menu">
                        <div class="menu_bar1"></div>
                        <div class="menu_bar2"></div>
                        <div class="menu_bar3"></div>
                    </div>
                </div>
                <div class="title">Dashboard Guru</div>

                <section id="laporan-section" class="card" aria-labelledby="form-title">
                    <h2
                        id="form-title"
                        style="
                            text-align: center;
                            margin-bottom: 28px;
                            color: #111;
                            font-size: 22px;
                        ">
                        Tambah Data Pelanggaran
                    </h2>

                    <form>
                        <div class="form-row">
                            <label for="nama">Siapa Yang Bikin Rusuh?</label>
                            <input
                                id="laporkan-nama"
                                type="text"
                                placeholder="Masukkan nama siswa" />
                        </div>

                        <div class="form-row">
                            <label for="jenis">Jenis Pelanggaran</label>
                            <div class="input-pelanggaran">
                                <select id="jenis">
                                </select>
                                <input
                                class="skor"
                                    id="skor"
                                    type="number"
                                    placeholder="2"
                                    readonly
                                    />
                            </div>
                        </div>

                        <div class="form-row-keterangan">
                            <label for="keterangan">Keterangan<button type="button"  class="input-keterangan" id="collapse-keterangan">+</button></label>
                        
                            <div class="input-keterangan-box" id="panel-keterangan">
                                <textarea id="keterangan" class="input-keterangan-text" rows="4" placeholder="Keterangan (opsional)"></textarea>
                            </div>
                        </div>

                        <div style="margin-top: 10px">
                            <button type="submit" class="btn-primary">
                                LAPORKAN DAN PANTAU
                            </button>
                        </div>

                        <p class="muted">
                            Mencatat untuk membina, menegakkan disiplin demi masa depan, Kedisiplinan adalah jembatan antara cita-cita dan
                            pencapaian.
                        </p>
                    </form>
                </section>

                <section id="statik-section" class="card" aria-labelledby="form-title">
                    <h2
                        id="form-title"
                        style="
                            text-align: center;
                            margin-bottom: 28px;
                            color: #111;
                            font-size: 22px;
                        ">
                        Pantau Statistik
                    </h2>
                    <div class="stats-wrapper">
                    
                        <div class="chart-container">
                            <div class="pie-chart-placeholder">
                                <div class="mockup-chart"><canvas id="pieChart"></canvas></div>
                            </div>
                            <div class="legend-area">
                            </div>
                        </div>
                    
                        <div class="violation-list-container">
                            <div class="list-header">
                                <h4>Aktivitas Terbaru</h4>
                                <div class="sort-controls">
                                    <button class="sort-btn active">Terbaru</button>
                                    <button class="sort-btn">Terbanyak</button>
                                </div>
                            </div>
                    
                            <div class="violation-scroll-area">
                                
                            </div>
                        </div>
                    
                    </div>
                    <p>Analisi Bulan Ini</p>
                </section>
                <section id="daf-section" class="card" aria-labelledby="form-title">
                    <h2 id="form-title" style="
                                            text-align: center;
                                            margin-bottom: 28px;
                                            color: #111;
                                            font-size: 22px;
                                        ">
                        Daftar Pelanggaran
                    </h2>
                    <div class="violation-table-container">
                    
                        <div class="category-tabs">
                            <button class="tab-btn active" onclick="filterTable('all')">Semua</button>
                            <button class="tab-btn" onclick="filterTable('kedisiplinan')">Kerajinan (J)</button>
                            <button class="tab-btn" onclick="filterTable('kebersihan')">Kerapian (P)</button>
                            <button class="tab-btn" onclick="filterTable('ketertiban')">Ketertiban (K)</button>
                            <button class="tab-btn" onclick="filterTable('berat')">Pelanggaran Berat</button>
                        </div>
                    
                        <div class="table-responsive">
                            <table class="modern-table" id="violationTable">
                                <thead>
                                    <tr>
                                        <th width="80px">Kode</th>
                                        <th>Jenis Pelanggaran</th>
                                        <th width="150px">Kategori</th>
                                        <th width="80px" class="text-center">Poin</th>
                                    </tr>
                                </thead>
                                <tbody>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </section>

                <section id="manage-section" class="card" aria-labelledby="form-title" style="background: #7a6fafb6; color: white;">
                    <h2 id="form-title" style="
                                            text-align: center;
                                            margin-bottom: 28px;
                                            color: white;
                                            font-size: 22px;
                                        ">
                        Manajement Sistem
                    </h2>
                    <div class="mgmt-grid">
                    
                        <div class="mgmt-card form-card" style="padding-bottom: 50px;">
                            <div class="card-decoration"></div>
                            <div class="card-content">
                                <h3>Tambah Anggota Siswa</h3>
                    
                                <form class="modern-form">
                                    <div class="form-group">
                                        <input type="text" id="nama-siswa" class="modern-input" placeholder="Nama Lengkap Siswa">
                                    </div>
                    
                                    <div class="form-row-split">
                                        <div class="form-group">
                                            <input id="nis-siswa" class="modern-input" placeholder="NIS">
                                        </div>
                                        <div class="form-group">
                                            <select id="kelas-siswa" class="modern-input select-icon">
                                                <option value="" disabled selected>Kelas</option>
                                                <option value="X1">Kelas X.1</option>
                                                <option value="X2">Kelas X.2</option>
                                                <option value="X3">Kelas X.3</option>
                                                <option value="X4">Kelas X.4</option>
                                                <option value="X5">Kelas X.5</option>
                                                <option value="X6">Kelas X.6</option>
                                                <option value="X7">Kelas X.7</option>
                                                <option value="X8">Kelas X.8</option>
                                                <option value="X9">Kelas X.9</option>
                                                <option value="X10">Kelas X.10</option>
                                                <option value="XI1">Kelas XI.1</option>
                                                <option value="XI2">Kelas XI.2</option>
                                                <option value="XI3">Kelas XI.3</option>
                                                <option value="XI4">Kelas XI.4</option>
                                                <option value="XI5">Kelas XI.5</option>
                                                <option value="XI6">Kelas XI.6</option>
                                                <option value="XI7">Kelas XI.7</option>
                                                <option value="XI8">Kelas XI.8</option>
                                                <option value="XI9">Kelas XI.9</option>
                                                <option value="XI10">Kelas XI.10</option>
                                                <option value="XII1">Kelas XII.1</option>
                                                <option value="XII2">Kelas XII.2</option>
                                                <option value="XII3">Kelas XII.3</option>
                                                <option value="XII4">Kelas XII.4</option>
                                                <option value="XII5">Kelas XII.5</option>
                                                <option value="XII6">Kelas XII.6</option>
                                                <option value="XII7">Kelas XII.7</option>
                                                <option value="XII8">Kelas XII.8</option>
                                                <option value="XII9">Kelas XII.9</option>
                                                <option value="XII10">Kelas XII.10</option>
                                            </select>
                                        </div>
                                        <div class="form-group">
                                            <button type="button" class="btn-action primary">
                                                <span>TAMBAH</span>
                                            </button>
                                        </div>
                                    </div>
                                </form>
                            </div>
                        </div>
                    
                        <div class="mgmt-card violation-card">
                        <div class="card-decoration"></div>
                        <div class="card-content">
                            <div class="card-header-row">
                                <div class="header-text">
                                    <h3>Daftar Pelanggaran</h3>
                                    <p>Tambah atau hapus jenis pelanggaran & poin.</p>
                                </div>
                            </div>

                            <div class="add-violation-wrapper">
                                <div class="input-row-joined">
                                    <input list="violation-suggestions" type="text" class="modern-input input-name" placeholder="Nama Pelanggaran (misal: Terlambat)">
                                    <datalist id="violation-suggestions">
                                        <option value="Terlambat Masuk Sekolah">
                                        <option value="Tidak Memakai Dasi">
                                        <option value="Membuang Sampah Sembarangan">
                                    </datalist>

                                    <input type="number" class="modern-input input-point" placeholder="Poin" min="1" max="100">
                                    
                                    <button class="btn-add-icon">
                                        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3" stroke-linecap="round" stroke-linejoin="round"><line x1="12" y1="5" x2="12" y2="19"></line><line x1="5" y1="12" x2="19" y2="12"></line></svg>
                                    </button>
                                </div>
                            </div>

                            <div class="violation-list-container">
                                <h5 class="list-label">Daftar Saat Ini:</h5>
                                
                                <div class="violation-scroll-list">
                                </div>
                            </div>

                        </div>
                    </div>
                    
                    </div>
                </section>
            </main>
        </div>

        <div class="wave-section">
            <svg class="wave" viewBox="0 0 1440 320">
                <path fill="white" fill-opacity="1"
                    d="M0,128L30,144C60,160,120,192,180,202.7C240,213,300,203,360,186.7C420,171,480,149,540,144C600,139,660,149,720,160C780,171,840,181,900,170.7C960,160,1020,128,1080,117.3C1140,107,1200,117,1260,128C1320,139,1380,149,1410,154.7L1440,160L1440,320L1410,320C1380,320,1320,320,1260,320C1200,320,1140,320,1080,320C1020,320,960,320,900,320C840,320,780,320,720,320C660,320,600,320,540,320C480,320,420,320,360,320C300,320,240,320,180,320C120,320,60,320,30,320H0V128Z">
                </path>
            </svg>
            <div class="white-page">
                <div class="area">
                    <ul class="circles">
                        <li></li>
                        <li></li>
                        <li></li>
                        <li></li>
                        <li></li>
                        <li></li>
                        <li></li>
                        <li></li>
                        <li></li>
                        <li></li>
                    </ul>
                </div>
            </div>
        </div>
        <script src="./program/database/account.js"></script>
        <script src="./program/database/pelanggaran.js"></script>
        <script src="program/statistik.js"></script>
        <script src="./program/select-pelanggaran.js"></script>
        <script src="./program/daftar-pelanggaran.js"></script>
        <script src="./program/violation-mgmt.js"></script>
        <script src="./program/laporkan.js"></script>
        <script src="./program/scroll-section.js"></script>
        <script>
            document.addEventListener("DOMContentLoaded", () => {
                const user = JSON.parse(sessionStorage.getItem("loggedUser"));

                if (!user) {
                    location.assign("../index.html");
                    return;
                }

                document.querySelectorAll(".username-display").forEach(a => {
                    a.textContent = user.name;
                });
            })


            const btn = document.getElementById("collapse-keterangan");
            const box = document.getElementById("panel-keterangan");

            const bg = document.querySelector(".form-row-keterangan");

            btn.addEventListener("click", () => {
                if (box.style.display === "none") {
                    box.style.display = "block";
                    btn.textContent = "-";
                    bg.style.height = "120px";
                } else {
                    box.style.display = "none";
                    btn.textContent = "+";
                    bg.style.height = "50px";
                }
            });

            const menu = document.querySelector('.menu');
            const sidebar = document.querySelector(".sidebar");
            const main = document.querySelector(".main");

            menu.addEventListener('click', () => {
                sidebar.classList.toggle("active");
                main.classList.toggle("shift");
                menu.classList.toggle('change');
            });

            function filterTable(category) {
                const buttons = document.querySelectorAll('.tab-btn');
                buttons.forEach(btn => btn.classList.remove('active'));
                event.target.classList.add('active');

                // 2. Filter baris tabel
                const rows = document.querySelectorAll('.row-item');
                
                rows.forEach(row => {
                    if (category === 'all') {
                    row.style.display = '';
                    } else {
                    if (row.getAttribute('data-category') === category) {
                        row.style.display = '';
                    } else {
                        row.style.display = 'none';
                    }
                    }
                });
            }
        </script>
        <script>
            document.addEventListener("DOMContentLoaded", () => {
                const sortBtns = document.querySelectorAll(".sort-btn");
                const listArea = document.querySelector(".violation-scroll-area");
                function parseTime(text) {
                    const num = parseInt(text);
                    if (text.includes("m")) return num * 1;            // menit
                    if (text.includes("j")) return num * 60;           // jam → menit
                    if (text.includes("h")) return num * 1440;         // hari → menit
                    return 999999; // fallback
                }

                function parsePoint(text) {
                    return parseInt(text.replace(/[^0-9-]/g, ""));
                }

                function sortList(mode) {
                    const items = Array.from(document.querySelectorAll(".violation-item"));

                    let sorted = items;

                    if (mode === "terbaru") {
                        sorted = items.sort((a, b) => {
                            const timeA = parseTime(a.querySelector(".v-time").textContent);
                            const timeB = parseTime(b.querySelector(".v-time").textContent);
                            return timeA - timeB; // paling kecil berarti paling baru
                        });
                    }

                    if (mode === "terbanyak") {
                        sorted = items.sort((a, b) => {
                            const pointA = Math.abs(parsePoint(a.querySelector(".v-points").textContent));
                            const pointB = Math.abs(parsePoint(b.querySelector(".v-points").textContent));
                            return pointB - pointA; // poin paling besar dulu
                        });
                    }

                    // Render ulang list
                    listArea.innerHTML = "";
                    sorted.forEach(item => listArea.appendChild(item));
                }

                sortBtns.forEach(btn => {
                    btn.addEventListener("click", () => {
                        sortBtns.forEach(b => b.classList.remove("active"));
                        btn.classList.add("active");

                        if (btn.textContent.trim().toLowerCase() === "terbaru") {
                            sortList("terbaru");
                        } else {
                            sortList("terbanyak");
                        }
                    });
                });
            });

            document.querySelector(".nav-btn.logout").addEventListener("click", () => {   
                localStorage.removeItem("currentUser");
                sessionStorage.removeItem("currentUser");
                document.cookie = "currentUser=; expires=Thu, 01 Jan 1970 00:00:00 UTC; path=/;";
                window.location.href = "login.html";
            });

            </script>

	</body>
</html>
